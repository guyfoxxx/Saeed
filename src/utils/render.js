import { parseDSL } from "./parser.js"; export function dslToSvg(dsl,{width=600,height=400,title="Schematic"}={}){ const {items}=parseDSL(dsl); const parts=[]; parts.push(`<svg xmlns="http://www.w3.org/2000/svg" width="${width}" height="${height}">`); parts.push(`<title>${title}</title>`); parts.push(`<rect x="0" y="0" width="${width}" height="${height}" fill="#fff"/>`); for(const it of items){ if(it.type.toUpperCase()==="R"){ parts.push(`<rect x="${it.x}" y="${it.y}" width="40" height="10" fill="#333"/><text x="${it.x+45}" y="${it.y+10}" font-size="12">${it.label||"R"}</text>`); } else if(it.type.toUpperCase()==="C"){ parts.push(`<rect x="${it.x}" y="${it.y}" width="4" height="12" fill="#333"/><rect x="${it.x+8}" y="${it.y}" width="4" height="12" fill="#333"/><text x="${it.x+20}" y="${it.y+10}" font-size="12">${it.label||"C"}</text>`); } else if(it.type.toUpperCase()==="WIRE"){ const [x2,y2]=(it.label||"").split(/\s+/).map(Number); parts.push(`<line x1="${it.x}" y1="${it.y}" x2="${x2||it.x+40}" y2="${y2||it.y}" stroke="#000" stroke-width="2"/>`); } else { parts.push(`<circle cx="${it.x}" cy="${it.y}" r="4" fill="#000"/><text x="${it.x+6}" y="${it.y+4}" font-size="12">${it.label||it.type}</text>`); } } parts.push(`</svg>`); return parts.join(""); } export async function trySvgToPng(svgText,env){ const wasmUrl=env.RESVG_WASM_URL||(await env.CFG_DB.get("cfg:RESVG_WASM_URL")); if(!wasmUrl) return null; try{ const res=await fetch(wasmUrl); if(!res.ok) return null; const wasm=await res.arrayBuffer(); await WebAssembly.instantiate(wasm,{}); return null; }catch{ return null; } }