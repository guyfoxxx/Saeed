export const userKey=(tid)=>`user:${tid}`; export const qbankKey=(id)=>`qbank:${id}`; export const cfgKey=(k)=>`cfg:${k}`; export const rrKey=(name)=>`rr:${name}:index`;
export const DB={ async getUser(env,tid){ const raw=await env.USER_DB.get(userKey(tid)); return raw?JSON.parse(raw):null; }, async putUser(env,tid,data){ await env.USER_DB.put(userKey(tid),JSON.stringify(data)); }, async getQ(env,id){ const raw=await env.QBANK_DB.get(qbankKey(id)); return raw?JSON.parse(raw):null; }, async putQ(env,id,data){ await env.QBANK_DB.put(qbankKey(id),JSON.stringify(data)); }, async listQ(env,prefix='qbank:'){ const list=await env.QBANK_DB.list({prefix}); return list.keys.map(k=>k.name.replace(/^qbank:/,'')); } };
export async function getCfg(env,key){ return await env.CFG_DB.get(cfgKey(key)); } export async function setCfg(env,key,value){ await env.CFG_DB.put(cfgKey(key),value); } export async function cfgDump(env){ const keys=await env.CFG_DB.list({prefix:"cfg:"}); const obj={}; for(const k of keys.keys){ const v=await env.CFG_DB.get(k.name); obj[k.name.substring(4)]=v; } return obj; }
import { runText, runVision } from "../models/router.js"; export async function testProviders(env,task,input,imageUrl){ if(task==="vision") return await runVision(env,imageUrl,input); return await runText(env,input); }